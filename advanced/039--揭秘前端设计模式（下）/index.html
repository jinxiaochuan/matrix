<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>核心进阶39 | 揭秘前端设计模式（下） | Matrix</title><meta name="author" content="小川"><meta name="copyright" content="小川"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="在上一讲中，我们介绍了设计模式的一些基本概念。本讲我们来结合实例，结合前端开发，继续讲解这个话题。 回顾一下设计模式的内容：  工厂模式在前端中的应用创建型的工厂模式一共分为三种：  简单工厂模式（Simple Factory） 工厂方法模式（Factory Method） 抽象工厂模式（Abstract Factory）  顾名思义，工厂模式就是隐藏了创建一个实例的复杂度，只需要提供一个简单的接">
<meta property="og:type" content="article">
<meta property="og:title" content="核心进阶39 | 揭秘前端设计模式（下）">
<meta property="og:url" content="https://jinxiaochuan.github.io/matrix/advanced/039--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8B%EF%BC%89/index.html">
<meta property="og:site_name" content="Matrix">
<meta property="og:description" content="在上一讲中，我们介绍了设计模式的一些基本概念。本讲我们来结合实例，结合前端开发，继续讲解这个话题。 回顾一下设计模式的内容：  工厂模式在前端中的应用创建型的工厂模式一共分为三种：  简单工厂模式（Simple Factory） 工厂方法模式（Factory Method） 抽象工厂模式（Abstract Factory）  顾名思义，工厂模式就是隐藏了创建一个实例的复杂度，只需要提供一个简单的接">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&refer=http%3A%2F%2F00.minipic.eastday.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1611283231&t=82f18a3b7b8ad76bf906bc78635e5360">
<meta property="article:published_time" content="2020-12-23T03:47:50.496Z">
<meta property="article:modified_time" content="2020-12-23T03:47:50.496Z">
<meta property="article:author" content="小川">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&refer=http%3A%2F%2F00.minipic.eastday.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1611283231&t=82f18a3b7b8ad76bf906bc78635e5360"><link rel="shortcut icon" href="/matrix/img/favicon.png"><link rel="canonical" href="https://jinxiaochuan.github.io/matrix/advanced/039--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8B%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/matrix/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/matrix/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-23 11:47:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://cdn.byai.com/static/oss-script/24f46d0537131bf25d5519070dbfd06d.jpeg?x-oss-process=image/crop,x_0,y_120,w_1000,h_1000" onerror="onerror=null;src='https://ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy/zhidao/wh%3D680%2C800/sign=23605bff60600c33f02cd6ce227c7d37/b64543a98226cffc56142759b2014a90f603ea1b.jpg'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/matrix/archives/"><div class="headline">文章</div><div class="length-num">53</div></a></div></div></div><hr/></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/matrix/">Matrix</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">核心进阶39 | 揭秘前端设计模式（下）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-23T03:47:50.496Z" title="更新于 2020-12-23 11:47:50">2020-12-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>在上一讲中，我们介绍了设计模式的一些基本概念。本讲我们来结合实例，结合前端开发，继续讲解这个话题。</p>
<p>回顾一下设计模式的内容：</p>
<p><img src="https://images.gitbook.cn/cb2e6d60-cbfe-11e9-a9bd-857608719494"></p>
<h3 id="工厂模式在前端中的应用"><a href="#工厂模式在前端中的应用" class="headerlink" title="工厂模式在前端中的应用"></a>工厂模式在前端中的应用</h3><p>创建型的工厂模式一共分为三种：</p>
<ul>
<li>简单工厂模式（Simple Factory）</li>
<li>工厂方法模式（Factory Method）</li>
<li>抽象工厂模式（Abstract Factory）</li>
</ul>
<p>顾名思义，工厂模式就是隐藏了创建一个实例的复杂度，只需要提供一个简单的接口调用，直接完成创建实例的目的。而这三种工厂模式的区别我认为没有太大必要去细分，重点还是在于应用。比如一个非常常见的场景，就是<br>jQuery 的选择器：</p>
<pre><code>class jQuery &#123;
    constructor(selector) &#123;
        super(selector)
    &#125;
    //  ....
&#125;

window.$ = function(selector) &#123;
    return new jQuery(selector)
&#125;</code></pre>
<p>这样的代码非常明显，我们需要构建一个 jQuery 实例时，只需要：</p>
<pre><code>$(&#39;selector&#39;)</code></pre>
<p>因为 <code>$</code> 已经被挂载在 window 上，而 <code>$</code> 作为一个函数，它直接返回了 new jQuery(selector)，开发者不需要再麻烦地使用<br><code>new $(&#39;selector&#39;)</code> 方式。</p>
<p>除了 jQuery 以外，React 开发者常用的 React.createElement 也是工厂模式的体现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">React.createElement(&#39;span&#39;, null, &#39;Factory Pattern!&#39;),</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>只要具有组件化思想的类库或者框架，无一例外都会使用工厂模式去创建组件实例，除了提到的 React、jQuery（jQuery UI）<br>以外，Vue，甚至是更古老的 ExtJS 都不例外。</p>
<p>我们再来看一个例子，请读者体会：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">class Car &#123;</span><br><span class="line">  constructor(options) &#123;</span><br><span class="line">    const &#123;doors &#x3D; 4, state &#x3D; &#39;new&#39;, color &#x3D; &#39;black&#39;&#125; &#x3D; options</span><br><span class="line">    this.doors &#x3D; doors</span><br><span class="line">    this.state &#x3D; state</span><br><span class="line">    this.color &#x3D; color</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Truck &#123;</span><br><span class="line">  constructor(options) &#123;</span><br><span class="line">    const &#123;wheelSize &#x3D; &#39;medium&#39;, state &#x3D; &#39;used&#39;, color &#x3D; &#39;silver&#39;&#125; &#x3D; options</span><br><span class="line">    this.wheelSize &#x3D; wheelSize</span><br><span class="line">    this.state &#x3D; state</span><br><span class="line">    this.color &#x3D; color</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class VehicleFactory &#123;</span><br><span class="line">  createVehicle(options) &#123;</span><br><span class="line">    switch (options.type) &#123;</span><br><span class="line">      case &#39;car&#39;:</span><br><span class="line">        this.vehicleTarget &#x3D; Car</span><br><span class="line">        break;</span><br><span class="line">      case &#39;truck&#39;:</span><br><span class="line">        this.vehicleTarget &#x3D; Truck</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        this.vehicleTarget &#x3D; Car</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return new this.vehicleTarget(options)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let factory &#x3D; new VehicleFactory()</span><br><span class="line"></span><br><span class="line">let instance1 &#x3D; factory.createVehicle(&#123;</span><br><span class="line">  type: &#39;car&#39;,</span><br><span class="line">  color: &#39;yellow&#39;,</span><br><span class="line">  doors: 4</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">let instance2 &#x3D; factory.createVehicle(&#123;</span><br><span class="line">  type: &#39;truck&#39;,</span><br><span class="line">  state: &#39;new&#39;,</span><br><span class="line">  wheelSize: &#39;small&#39;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">    instance1 instanceof Car</span><br><span class="line">    instance2 instanceof Truck</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line"></span><br><span class="line">都会返回</span><br><span class="line">true。理解了这个例子，其实你也就明白了建造者模式。“什么？我还不知道建造者模式是什么！”，没错，设计模式就是这样，重要的不是死记硬背每种模式的概念，而是在实际中应用，其实不经意之间，你一直在使用设计模式。</span><br><span class="line"></span><br><span class="line">### 单例模式在前端中的应用</span><br><span class="line"></span><br><span class="line">单例模式非常简单，通俗来说就是某个类只能有一个是实例。那么他的应用场景也就非常直观：引用第三方库，全局唯一的对象或者状态管理，全局唯一的插件等。在之前的课程中，我们通过闭包实现了单例模式，这里再次用</span><br><span class="line">ES6 实现：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    class Singleton &#123;</span><br><span class="line">      constructor() &#123;</span><br><span class="line">        if (!Singleton.instance) &#123;</span><br><span class="line">          Singleton.instance &#x3D; this;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        return Singleton.instance;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line"></span><br><span class="line">### 建造者模式在前端中的应用</span><br><span class="line"></span><br><span class="line">前面我们提到了建造者模式，这里再深入地进行了解。建造者的精髓在于“分步骤分情况构建一个复杂的对象”。比如我们想实现一个 pizza 类，用于生成 pizza</span><br><span class="line">实例：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    class Pizza &#123;</span><br><span class="line">        constructor(size, chesse &#x3D; true, tomato &#x3D; false, lettuce &#x3D; false) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line"></span><br><span class="line">构建一个 pizza 需要在初始化时传入需要的参数，如果这个 pizza 类变得复杂，比如需要声明是否添加 mushroom、oliver、poulet</span><br><span class="line">等，那么参数就会非常失控：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    class Pizza &#123;</span><br><span class="line">        constructor(size, mushroom &#x3D; true, oliver&#x3D; true, poulet &#x3D; false, chesse &#x3D; true, tomato &#x3D; false, lettuce &#x3D; false) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#96;&#96;&#96;     </span><br><span class="line"></span><br><span class="line">使用建造者模式：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    class Pizza &#123;</span><br><span class="line">        constructor(size) &#123;</span><br><span class="line">            this.size &#x3D; size</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addMushroom() &#123;</span><br><span class="line">            this.mushroom &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addOliver() &#123;</span><br><span class="line">            this.oliver &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addPoulet() &#123;</span><br><span class="line">            this.poulet &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addChesse() &#123;</span><br><span class="line">            this.chesse &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addTomato() &#123;</span><br><span class="line">            this.tomato &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        addLettuce() &#123;</span><br><span class="line">            this.lettuce &#x3D; true</span><br><span class="line">            return this</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        build() &#123;</span><br><span class="line">            return new Pizza(this)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>这样一来，使用就会更加优雅：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    new Pizza(32)</span><br><span class="line">        .addOliver()</span><br><span class="line">        .addTomato()</span><br><span class="line">        .build()</span><br><span class="line">&#96;&#96;&#96;     </span><br><span class="line"></span><br><span class="line">当然，你可以认为参数以对象的形式传入，就能解决参数过多以及参数顺序问题。可是往往构造一个对象并不只是参数的问题。比如构建一个复杂的 DOM 结构，而针对于此</span><br><span class="line">jQuery 利用建造者模式简化了构建 DOM 的过程：</span><br><span class="line"></span><br><span class="line">我们可以通过多种方式构造 DOM ：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    $( &quot;&lt;div class&#x3D; &quot;foo&quot;&gt;bar&lt;&#x2F;div&gt;&quot; );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    $( &quot;&lt;p id&#x3D;&quot;test&quot;&gt;foo &lt;em&gt;bar&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;&quot;).appendTo(&quot;body&quot; );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    var newParagraph &#x3D; $( &quot;&lt;p &#x2F;&gt;&quot; ).text( &quot;Hello world&quot; );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    $( &quot;&lt;input &#x2F;&gt;&quot; )</span><br><span class="line">          .attr(&#123; &quot;type&quot;: &quot;text&quot;, &quot;id&quot;:&quot;sample&quot;&#125;);</span><br><span class="line">          .appendTo(&quot;#container&quot;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>对应 jQuery.prototype 源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; HANDLE: $(html) -&gt; $(array)</span><br><span class="line">  if ( match[1] ) &#123;</span><br><span class="line">    context &#x3D; context instanceof jQuery ? context[0] : context;</span><br><span class="line">    doc &#x3D; ( context ? context.ownerDocument || context : document );</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;如果传入的是单个字符串，并且是单个标记</span><br><span class="line">    &#x2F;&#x2F;只需执行 createElement 并跳过其余部分</span><br><span class="line">    </span><br><span class="line">    ret &#x3D; rsingleTag.exec( selector );</span><br><span class="line">    </span><br><span class="line">    if ( ret ) &#123;</span><br><span class="line">      if ( jQuery.isPlainObject( context ) ) &#123;</span><br><span class="line">        selector &#x3D; [ document.createElement( ret[1] ) ];</span><br><span class="line">        jQuery.fn.attr.call( selector, context, true );</span><br><span class="line">    </span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        selector &#x3D; [ doc.createElement( ret[1] ) ];</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      ret &#x3D; jQuery.buildFragment( [ match[1] ], [ doc ] );</span><br><span class="line">      selector &#x3D; ( ret.cacheable ? jQuery.clone(ret.fragment) </span><br><span class="line">      : ret.fragment ).childNodes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return jQuery.merge( this, selector );</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="外观模式在前端中的应用"><a href="#外观模式在前端中的应用" class="headerlink" title="外观模式在前端中的应用"></a>外观模式在前端中的应用</h3><p>外观模式的精髓在于对接口进行二次封装，隐藏其内部的复杂度。这种设计在前端开发中也非常常见，比如跨浏览器兼容性的封装，比如事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var addMyEvent &#x3D; function( el,ev,fn )&#123;</span><br><span class="line">  if( el.addEventListener )&#123;&#x2F;&#x2F;存在 DOM2 级方法，则使用并传入事件类型、事件处理程序函数和第3个参数 false（表示冒泡阶段）</span><br><span class="line">        el.addEventListener( ev,fn, false );</span><br><span class="line">  &#125;else if(el.attachEvent)&#123; &#x2F;&#x2F; 为兼容 IE8 及更早浏览器，注意事件类型必须加上&quot;on&quot;前缀</span><br><span class="line">        el.attachEvent( &quot;on&quot; + ev, fn );</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">       el[&quot;on&quot; + ev] &#x3D; fn;&#x2F;&#x2F;其他方法都无效，默认采用 DOM0 级方法，使用方括号语法将属性名指定为事件处理程序</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再比如 <code>$(document).ready</code> 的用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">bindReady: function() &#123;</span><br><span class="line">    ...</span><br><span class="line">    if ( document.addEventListener ) &#123;</span><br><span class="line">      &#x2F;&#x2F; Use the handy event callback</span><br><span class="line">      document.addEventListener( &quot;DOMContentLoaded&quot;, DOMContentLoaded, false );</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; A fallback to window.onload, that will always work</span><br><span class="line">      window.addEventListener( &quot;load&quot;, jQuery.ready, false );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; If IE event model is used</span><br><span class="line">    &#125; else if ( document.attachEvent ) &#123;</span><br><span class="line"></span><br><span class="line">      document.attachEvent( &quot;onreadystatechange&quot;, DOMContentLoaded );</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; A fallback to window.onload, that will always work</span><br><span class="line">      window.attachEvent( &quot;onload&quot;, jQuery.ready );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再看一个例子，外观模式和模块化的结合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var module &#x3D; (function() &#123;</span><br><span class="line">    var _private &#x3D; &#123;</span><br><span class="line">        i: 5,</span><br><span class="line">        get: function() &#123;</span><br><span class="line">            console.log( &quot;current value:&quot; + this.i);</span><br><span class="line">        &#125;,</span><br><span class="line">        set: function( val ) &#123;</span><br><span class="line">            this.i &#x3D; val;</span><br><span class="line">        &#125;,</span><br><span class="line">        run: function() &#123;</span><br><span class="line">            console.log( &quot;running&quot; );</span><br><span class="line">        &#125;,</span><br><span class="line">        jump: function()&#123;</span><br><span class="line">            console.log( &quot;jumping&quot; );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">        facade: function( args ) &#123;</span><br><span class="line">            _private.set(args.val);</span><br><span class="line">            _private.get();</span><br><span class="line">            if ( args.run ) &#123;</span><br><span class="line">                _private.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Outputs: &quot;current value: 10&quot; and &quot;running&quot;</span><br><span class="line">module.facade( &#123;run: true, val: 10&#125; );</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在这个例子中，开发者只需要调用 module.facade( {run: true, val: 10}<br>)，调用后会触发模块当中私有方法，实现对数值的改写，我们并不需要明白 module 内部实现，只需要关心其封装即可。</p>
<h3 id="适配器模式在前端中的应用"><a href="#适配器模式在前端中的应用" class="headerlink" title="适配器模式在前端中的应用"></a>适配器模式在前端中的应用</h3><p>适配器模式在于适配两个及以上类接口不兼容的问题，和外观模式的核心思路类似。在 jQuery 中也广泛应用，我们知道 opacity<br>属性在不同浏览器中的表现方式不同。</p>
<p>在 Chrome 4+、FF2+、Saf3.1+、Opera 9+、IE9、iOS 3.2+、Android 2.1+ 中：</p>
<pre><code>opacity: 0.9</code></pre>
<p>是常见用法，但是在 IE6-8，却是：</p>
<pre><code>filter: alpha(opacity=90)</code></pre>
<p>jQuery 利用适配器模式，对这种差异进行了抹平：</p>
<pre><code>// 读
$( &quot;.container&quot; ).css( &#123; opacity: .5 &#125; );

// 取
let opacity = $( &quot;.container&quot; ).css( &#123; opacity: .5 &#125; );</code></pre>
<p>其内部实现为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    get: function( elem, computed ) &#123;</span><br><span class="line">      &#x2F;&#x2F; IE uses filters for opacity</span><br><span class="line">      return ropacity.test( (</span><br><span class="line">            computed &amp;&amp; elem.currentStyle ?</span><br><span class="line">                elem.currentStyle.filter : elem.style.filter) || &quot;&quot; ) ?</span><br><span class="line">        ( parseFloat( RegExp.$1 ) &#x2F; 100 ) + &quot;&quot; :</span><br><span class="line">        computed ? &quot;1&quot; : &quot;&quot;;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    set: function( elem, value ) &#123;</span><br><span class="line">      var style &#x3D; elem.style,</span><br><span class="line">        currentStyle &#x3D; elem.currentStyle,</span><br><span class="line">        opacity &#x3D; jQuery.isNumeric( value ) ?</span><br><span class="line">              &quot;alpha(opacity&#x3D;&quot; + value * 100 + &quot;)&quot; : &quot;&quot;,</span><br><span class="line">        filter &#x3D; currentStyle &amp;&amp; currentStyle.filter || style.filter || &quot;&quot;;</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; IE has trouble with opacity if it does not have layout</span><br><span class="line">      &#x2F;&#x2F; Force it by setting the zoom level</span><br><span class="line">      style.zoom &#x3D; 1;</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; if setting opacity to 1, and no other filters</span><br><span class="line">      &#x2F;&#x2F;exist - attempt to remove filter attribute #6652</span><br><span class="line">      if ( value &gt;&#x3D; 1 &amp;&amp; jQuery.trim( filter.replace( ralpha, &quot;&quot; ) ) &#x3D;&#x3D;&#x3D; &quot;&quot; ) &#123;</span><br><span class="line">    </span><br><span class="line">        &#x2F;&#x2F; Setting style.filter to null, &quot;&quot; &amp; &quot; &quot; still leave</span><br><span class="line">        &#x2F;&#x2F; &quot;filter:&quot; in the cssText if &quot;filter:&quot; is present at all,</span><br><span class="line">        &#x2F;&#x2F; clearType is disabled, we want to avoid this style.removeAttribute</span><br><span class="line">        &#x2F;&#x2F; is IE Only, but so apparently is this code path...</span><br><span class="line">        style.removeAttribute( &quot;filter&quot; );</span><br><span class="line">    </span><br><span class="line">        &#x2F;&#x2F; if there there is no filter style applied in a css rule, we are done</span><br><span class="line">        if ( currentStyle &amp;&amp; !currentStyle.filter ) &#123;</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; otherwise, set new filter values</span><br><span class="line">      style.filter &#x3D; ralpha.test( filter ) ?</span><br><span class="line">        filter.replace( ralpha, opacity ) :</span><br><span class="line">        filter + &quot; &quot; + opacity;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line"></span><br><span class="line">### 享元模式在前端中的应用</span><br><span class="line"></span><br><span class="line">我个人认为享元模式非常重要，他是用于性能优化的一种常见模式。它依靠：</span><br><span class="line"></span><br><span class="line">  * 主减少创建对象实例的数量</span><br><span class="line">  * 运用共享技术来有效支持大量细粒度的对象</span><br><span class="line"></span><br><span class="line">这两种方式减少内存占用，以提高性能。在 JavaScript</span><br><span class="line">中，浏览器特别是移动端的浏览器所占有的内存并不算多，因此合理利用享元模式，达到节省内存的目的，就成了一件非常有意义的优化。</span><br><span class="line"></span><br><span class="line">在 Java 中有一个关键字：implements，它用于接入接口 interfaces，这在 JavaScript</span><br><span class="line">语言中并不存在，但是我们仍然可以模拟一个：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    Function.prototype.implementsFor &#x3D; function( parentClassOrObject )&#123;</span><br><span class="line">        if ( parentClassOrObject.constructor &#x3D;&#x3D;&#x3D; Function )</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F; Normal Inheritance</span><br><span class="line">            this.prototype &#x3D; new parentClassOrObject();</span><br><span class="line">            this.prototype.constructor &#x3D; this;</span><br><span class="line">            this.prototype.parent &#x3D; parentClassOrObject.prototype;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F; Pure Virtual Inheritance</span><br><span class="line">            this.prototype &#x3D; parentClassOrObject;</span><br><span class="line">            this.prototype.constructor &#x3D; this;</span><br><span class="line">            this.prototype.parent &#x3D; parentClassOrObject;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;;</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line"></span><br><span class="line">我们看：implementsFor 作用于一个构造函数，它接受一个父类（function）或者一个</span><br><span class="line">object，并继承该父类构造函数（function）或者指定的 object。上段代码并不难理解，我们看一个应用实例：</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#96;&#96;&#96; tsx    </span><br><span class="line">    &#x2F;&#x2F; Flyweight object</span><br><span class="line">    var CoffeeOrder &#x3D; &#123;</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; Interfaces</span><br><span class="line">      serveCoffee:function(context)&#123;&#125;,</span><br><span class="line">        getFlavor:function()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ConcreteFlyweight object that creates ConcreteFlyweight</span><br><span class="line">    &#x2F;&#x2F; Implements CoffeeOrder</span><br><span class="line">    function CoffeeFlavor( newFlavor )&#123;</span><br><span class="line">    </span><br><span class="line">        var flavor &#x3D; newFlavor;</span><br><span class="line">    </span><br><span class="line">        &#x2F;&#x2F; If an interface has been defined for a feature</span><br><span class="line">        &#x2F;&#x2F; implement the feature</span><br><span class="line">        if( typeof this.getFlavor &#x3D;&#x3D;&#x3D; &quot;function&quot; )&#123;</span><br><span class="line">          this.getFlavor &#x3D; function() &#123;</span><br><span class="line">              return flavor;</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        if( typeof this.serveCoffee &#x3D;&#x3D;&#x3D; &quot;function&quot; )&#123;</span><br><span class="line">          this.serveCoffee &#x3D; function( context ) &#123;</span><br><span class="line">            console.log(&quot;Serving Coffee flavor &quot;</span><br><span class="line">              + flavor</span><br><span class="line">              + &quot; to table number &quot;</span><br><span class="line">              + context.getTable());</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Implement interface for CoffeeOrder</span><br><span class="line">    CoffeeFlavor.implementsFor( CoffeeOrder );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Handle table numbers for a coffee order</span><br><span class="line">    function CoffeeOrderContext( tableNumber ) &#123;</span><br><span class="line">       return&#123;</span><br><span class="line">          getTable: function() &#123;</span><br><span class="line">             return tableNumber;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function CoffeeFlavorFactory() &#123;</span><br><span class="line">        var flavors &#x3D; &#123;&#125;,</span><br><span class="line">        length &#x3D; 0;</span><br><span class="line">    </span><br><span class="line">        return &#123;</span><br><span class="line">            getCoffeeFlavor: function (flavorName) &#123;</span><br><span class="line">    </span><br><span class="line">                var flavor &#x3D; flavors[flavorName];</span><br><span class="line">                if (typeof flavor &#x3D;&#x3D;&#x3D; &quot;undefined&quot;) &#123;</span><br><span class="line">                    flavor &#x3D; new CoffeeFlavor(flavorName);</span><br><span class="line">                    flavors[flavorName] &#x3D; flavor;</span><br><span class="line">                    length++;</span><br><span class="line">                &#125;</span><br><span class="line">                return flavor;</span><br><span class="line">            &#125;,</span><br><span class="line">    </span><br><span class="line">            getTotalCoffeeFlavorsMade: function () &#123;</span><br><span class="line">                return length;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Sample usage:</span><br><span class="line">    &#x2F;&#x2F; testFlyweight()</span><br><span class="line">    </span><br><span class="line">    function testFlyweight()&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; The flavors ordered.</span><br><span class="line">      var flavors &#x3D; [],</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; The tables for the orders.</span><br><span class="line">        tables &#x3D; [],</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; Number of orders made</span><br><span class="line">        ordersMade &#x3D; 0,</span><br><span class="line">    </span><br><span class="line">      &#x2F;&#x2F; The CoffeeFlavorFactory instance</span><br><span class="line">        flavorFactory &#x3D; new CoffeeFlavorFactory();</span><br><span class="line">    </span><br><span class="line">      function takeOrders( flavorIn, table) &#123;</span><br><span class="line">         flavors.push( flavorFactory.getCoffeeFlavor( flavorIn ) );</span><br><span class="line">         tables.push( new CoffeeOrderContext( table ) );</span><br><span class="line">         ordersMade++;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 2);</span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 2);</span><br><span class="line">       takeOrders(&quot;Frappe&quot;, 1);</span><br><span class="line">       takeOrders(&quot;Frappe&quot;, 1);</span><br><span class="line">       takeOrders(&quot;Xpresso&quot;, 1);</span><br><span class="line">       takeOrders(&quot;Frappe&quot;, 897);</span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 97);</span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 97);</span><br><span class="line">       takeOrders(&quot;Frappe&quot;, 3);</span><br><span class="line">       takeOrders(&quot;Xpresso&quot;, 3);</span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 3);</span><br><span class="line">       takeOrders(&quot;Xpresso&quot;, 96);</span><br><span class="line">       takeOrders(&quot;Frappe&quot;, 552);</span><br><span class="line">       takeOrders(&quot;Cappuccino&quot;, 121);</span><br><span class="line">       takeOrders(&quot;Xpresso&quot;, 121);</span><br><span class="line">    </span><br><span class="line">       for (var i &#x3D; 0; i &lt; ordersMade; ++i) &#123;</span><br><span class="line">           flavors[i].serveCoffee(tables[i]);</span><br><span class="line">       &#125;</span><br><span class="line">       console.log(&quot; &quot;);</span><br><span class="line">       console.log(&quot;total CoffeeFlavor objects made: &quot; + flavorFactory.getTotalCoffeeFlavorsMade());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>这个例子中，CoffeeFlavor 接入了 CoffeeOrder 的接口。接口的概念也许对于传统的 JavaScript<br>开发者有些陌生，我们再来看一个更加具有表现力的例子：在图书管理系统中，每本书都有以下特性：</p>
<ul>
<li>ID</li>
<li>Title</li>
<li>Author</li>
<li>Genre</li>
<li>Page count</li>
<li>Publisher ID</li>
<li>ISBN</li>
</ul>
<p>同时我们需要以下属性来追踪每一本书时，记录它是否可用、归还时间等：</p>
<ul>
<li>checkoutDate</li>
<li>checkoutMember</li>
<li>dueReturnDate</li>
<li>availability</li>
</ul>
<p>那么 Book 这个类看上去就像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">var Book &#x3D; function( id, title, author, genre, pageCount,publisherID, ISBN, checkoutDate, checkoutMember, dueReturnDate,availability )&#123;</span><br><span class="line"></span><br><span class="line">   this.id &#x3D; id;</span><br><span class="line">   this.title &#x3D; title;</span><br><span class="line">   this.author &#x3D; author;</span><br><span class="line">   this.genre &#x3D; genre;</span><br><span class="line">   this.pageCount &#x3D; pageCount;</span><br><span class="line">   this.publisherID &#x3D; publisherID;</span><br><span class="line">   this.ISBN &#x3D; ISBN;</span><br><span class="line">   this.checkoutDate &#x3D; checkoutDate;</span><br><span class="line">   this.checkoutMember &#x3D; checkoutMember;</span><br><span class="line">   this.dueReturnDate &#x3D; dueReturnDate;</span><br><span class="line">   this.availability &#x3D; availability;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Book.prototype &#x3D; &#123;</span><br><span class="line"></span><br><span class="line">  getTitle: function () &#123;</span><br><span class="line">     return this.title;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getAuthor: function () &#123;</span><br><span class="line">     return this.author;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getISBN: function ()&#123;</span><br><span class="line">     return this.ISBN;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; For brevity, other getters are not shown</span><br><span class="line">  updateCheckoutStatus: function( bookID, newStatus, checkoutDate, checkoutMember, newReturnDate )&#123;</span><br><span class="line"></span><br><span class="line">     this.id &#x3D; bookID;</span><br><span class="line">     this.availability &#x3D; newStatus;</span><br><span class="line">     this.checkoutDate &#x3D; checkoutDate;</span><br><span class="line">     this.checkoutMember &#x3D; checkoutMember;</span><br><span class="line">     this.dueReturnDate &#x3D; newReturnDate;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  extendCheckoutPeriod: function( bookID, newReturnDate )&#123;</span><br><span class="line"></span><br><span class="line">      this.id &#x3D; bookID;</span><br><span class="line">      this.dueReturnDate &#x3D; newReturnDate;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  isPastDue: function(bookID)&#123;</span><br><span class="line"></span><br><span class="line">     var currentDate &#x3D; new Date();</span><br><span class="line">     return currentDate.getTime() &gt; Date.parse( this.dueReturnDate );</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这么看上去并没有什么问题，但是当图书增多时，对于系统的压力会逐渐增多。为此我们将书的属性分为两种：本身固有的和外在特性。本身固有的属性包括<br>title、author 等，外在特性包括 checkoutMember、dueReturnDate 等。这样一来，我们简化书的构造函数为：</p>
<pre><code>var Book = function ( title, author, genre, pageCount, publisherID, ISBN ) &#123;

    this.title = title;
    this.author = author;
    this.genre = genre;
    this.pageCount = pageCount;
    this.publisherID = publisherID;
    this.ISBN = ISBN;

&#125;;</code></pre>
<p>我们将外在特性删去，check-outs 等信息将会被移动到一个新的类中，一个新的工厂函数也将出现：</p>
<pre><code>// Book Factory singleton
var BookFactory = (function () &#123;
  var existingBooks = &#123;&#125;, existingBook;

  return &#123;
    createBook: function ( title, author, genre, pageCount, publisherID, ISBN ) &#123;

      // Find out if a particular book meta-data combination has been created before
      // !! or (bang bang) forces a boolean to be returned
      existingBook = existingBooks[ISBN];
      if ( !!existingBook ) &#123;
        return existingBook;
      &#125; else &#123;

        // if not, let&#39;s create a new instance of the book and store it
        var book = new Book( title, author, genre, pageCount, publisherID, ISBN );
        existingBooks[ISBN] = book;
        return book;

      &#125;
    &#125;
  &#125;;

&#125;)();</code></pre>
<p>在这个工厂函数中，我们将会检查当前需要创建的书籍是否已经存在，如果存在直接返回书实例；否则进行调用 Book<br>构造函数进行创建。这保证了所有的书都是唯一的，而不存在重复。</p>
<p>对于书的外在特性，我们创建 BookRecordManager 来维护每一本书的状态，并通过 bookId 与每一个本书进行关系创建：</p>
<pre><code>var BookRecordManager = (function () &#123;

  var bookRecordDatabase = &#123;&#125;;

  return &#123;
    // add a new book into the library system
    addBookRecord: function ( id, title, author, genre, pageCount, publisherID, ISBN, checkoutDate, checkoutMember, dueReturnDate, availability ) &#123;

      var book = BookFactory.createBook( title, author, genre, pageCount, publisherID, ISBN );

      bookRecordDatabase[id] = &#123;
        checkoutMember: checkoutMember,
        checkoutDate: checkoutDate,
        dueReturnDate: dueReturnDate,
        availability: availability,
        book: book
      &#125;;
    &#125;,
    updateCheckoutStatus: function ( bookID, newStatus, checkoutDate, checkoutMember, newReturnDate ) &#123;

      var record = bookRecordDatabase[bookID];
      record.availability = newStatus;
      record.checkoutDate = checkoutDate;
      record.checkoutMember = checkoutMember;
      record.dueReturnDate = newReturnDate;
    &#125;,

    extendCheckoutPeriod: function ( bookID, newReturnDate ) &#123;
      bookRecordDatabase[bookID].dueReturnDate = newReturnDate;
    &#125;,

    isPastDue: function ( bookID ) &#123;
      var currentDate = new Date();
      return currentDate.getTime() &gt; Date.parse( bookRecordDatabase[bookID].dueReturnDate );
    &#125;
  &#125;;

&#125;)();</code></pre>
<p>其实变动也比较明显，书目所有的外在特性都被从书本身的特性中抽离，现在被移动到 BookManager 的 BookDatabase<br>当中。对于书借入/借出的操作也移动到了 BookRecordManager 当中，因为这些方法需要直接操作书的外在特性。如此一来，比一本书拥有多项属性的大<br>object 模式更加高效，也更利于维护。</p>
<p>关于性能可以具体来看：如果有 30 本同样一本书的 copy，现有的模式下只存储了一个实例；同时对于书状态转移的函数，我们维护在 BookManager<br>当中，而不再出现在对象（原型）上，如果这些函数出现在每一个书实例当中，将会是更大的开销。</p>
<p>享元模式在前端还有更多的应用，比如事件代理就是一个很典型的体现：</p>
<pre><code>&lt;div id=&quot;container&quot;&gt;
   &lt;div class=&quot;toggle&quot; href=&quot;#&quot;&gt;More Info (Address)
       &lt;span class=&quot;info&quot;&gt;
           This is more information
       &lt;/span&gt;&lt;/div&gt;
   &lt;div class=&quot;toggle&quot; href=&quot;#&quot;&gt;Even More Info (Map)
       &lt;span class=&quot;info&quot;&gt;
          &lt;iframe src=&quot;http://www.map-generator.net/extmap.php?name=London&amp;amp;address=london%2C%20england&amp;amp;width=500...gt;&quot;&lt;/iframe&gt;
       &lt;/span&gt;
   &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>我们集中将事件处理放到父容器上：</p>
<pre><code>var stateManager = &#123;

  fly: function () &#123;

    var self = this;

    $( &quot;#container&quot; )
          .unbind()
          .on( &quot;click&quot;, &quot;div.toggle&quot;, function ( e ) &#123;
            self.handleClick( e.target );
          &#125;);
  &#125;,

  handleClick: function ( elem ) &#123;
    $( elem ).find( &quot;span&quot; ).toggle( &quot;slow&quot; );
  &#125;
&#125;;</code></pre>
<p>如此类似，前面课程提到过的 React 合成事件的池化机制，都体现了异曲同工之妙。</p>
<h3 id="代理模式在前端中的应用"><a href="#代理模式在前端中的应用" class="headerlink" title="代理模式在前端中的应用"></a>代理模式在前端中的应用</h3><p>代理模式大家应该都不陌生，ES next 提供的 Proxy 让我们实现代理模式变得更加容易。关于 Proxy<br>的使用这些基础内容这里不过多赘述，直接来看一些代理模式的应用场景。</p>
<p>我们对函数进行代理，对函数的返回结果进行缓存。在函数执行时，优先使用缓存值，否则返回执行计算值：</p>
<pre><code>const getCacheProxy = (fn, cache = new Map()) =&gt; 
  new Proxy(fn, &#123;
    apply(target, context, args) &#123;
      const argsString = args.join(&#39; &#39;)
      if (cache.has(argsString)) &#123;
        return cache.get(argsString)
      &#125;
      const result = fn(...args)
      cache.set(argsString, result)

      return result
    &#125;
  &#125;)</code></pre>
<p>另外一个类似的实现：</p>
<pre><code>const createThrottleProxy = (fn, timer) =&gt; &#123;
  let last = Date.now() - timer
  return new Proxy(fn, &#123;
    apply(target, context, args) &#123;
      if (Date.now() - last &gt;= rate) &#123;
        fn(args)
        last = Date.now()
      &#125;
    &#125;
  &#125;)
&#125;;</code></pre>
<p>这些内容在前面的课程都有渗透，相信读者已经不难理解了。我们再来看 jQuery 当中的例子：</p>
<pre><code>$( &quot;button&quot; ).on( &quot;click&quot;, function () &#123;
  // Within this function, &quot;this&quot; refers to the element that was clicked
  $( this ).addClass( &quot;active&quot; );
&#125;);</code></pre>
<p>通过 <code>$( this )</code> 可以获取到当前触发事件的元素，但是：</p>
<pre><code>$( &quot;button&quot; ).on( &quot;click&quot;, function () &#123;
  setTimeout(function () &#123;
    // &quot;this&quot; doesn&#39;t refer to our element!
    $( this ).addClass( &quot;active&quot; );
  &#125;);
&#125;);</code></pre>
<p>但是这里的 <code>$( this )</code> 不再是预期之中的结果。为此，jQuery 提供了 .proxy() 方法，这是典型的代理模式体现。</p>
<pre><code>$( &quot;button&quot; ).on( &quot;click&quot;, function () &#123;

    setTimeout( $.proxy( function () &#123;
        // &quot;this&quot; now refers to our element as we wanted
        $( this ).addClass( &quot;active&quot; );
    &#125;, this), 500);

    // the last &quot;this&quot; we&#39;re passing tells $.proxy() that our DOM element
    // is the value we want &quot;this&quot; to refer to.
&#125;);</code></pre>
<p>来看一下 proxy 的实现：</p>
<pre><code>// Bind a function to a context, optionally partially applying any
// arguments.
proxy: function( fn, context ) &#123;
  if ( typeof context === &quot;string&quot; ) &#123;
    var tmp = fn[ context ];
    context = fn;
    fn = tmp;
  &#125;

  // Quick check to determine if target is callable, in the spec
  // this throws a TypeError, but we will just return undefined.
  if ( !jQuery.isFunction( fn ) ) &#123;
    return undefined;
  &#125;

  // Simulated bind
  var args = slice.call( arguments, 2 ),
    proxy = function() &#123;
      return fn.apply( context, args.concat( slice.call( arguments ) ) );
    &#125;;

  // Set the guid of unique handler to the same of original handler, so it can be removed
  proxy.guid = fn.guid = fn.guid || proxy.guid || jQuery.guid++;

  return proxy;
&#125;</code></pre>
<h3 id="装饰者模式在前端中的应用"><a href="#装饰者模式在前端中的应用" class="headerlink" title="装饰者模式在前端中的应用"></a>装饰者模式在前端中的应用</h3><p>装饰者模式如同代理模式一样，如今 JavaScript<br>也已经原生能够很好地进行支持了。简单来说就是在不改变原对象的基础上，对其对象进行包装和拓展，使原对象能够应对更加复杂的需求。这就有一点像高阶函数，因此在前端开发中非常多见：</p>
<pre><code>import React, &#123; Component &#125; from &#39;react&#39;
import &#123;connect&#125; from &#39;react-redux&#39;
class App extends Component &#123;
 render() &#123;
  //...
 &#125;
&#125;
export default connect(mapStateToProps,actionCreators)(App);</code></pre>
<p>或者在 Ant design 中：</p>
<pre><code>class CustomizedForm extends React.Component &#123;&#125;

CustomizedForm = Form.create(&#123;&#125;)(CustomizedForm)</code></pre>
<p>当然 TypeScript 函数修饰符 @ 也是类似的。</p>
<p>借助装饰者模式，很容易衍生出 AOP 面向切面编程的概念：</p>
<pre><code>Function.prototype.before = function(fn) &#123;
  const self = this
  return function() &#123;
    fn.apply(new(self), arguments)
    return self.apply(new(self), arguments)
  &#125;
&#125;

Function.prototype.after = function(fn) &#123;
  const self = this
  return function() &#123;
    self.apply(new(self), arguments)
    return fn.apply(new(self), arguments)
  &#125;
&#125;</code></pre>
<p>其实面向切面编程和装饰者模式思想是完全一致的。典型场景就是对表单的验证，我们将把表单输入逻辑校验的 validata 函数融入到 before 逻辑当中：</p>
<pre><code>Function.prototype.before = function( beforefn ) &#123;
  const self = this
  return function()&#123;
    if ( beforefn.apply( this, arguments ) === false ) return 
    return self.apply( this, arguments )
  &#125;
&#125;


const validate = function()&#123;
  // 表单验证逻辑
&#125;

const formSubmit = function() &#123;
  // 表达提交逻辑
  ajax( &#39;http:// xxx.com/login&#39;, param )
&#125;

submitBtn.onclick = function() &#123;
  formSubmit.before( validate )
&#125;</code></pre>
<h3 id="职责链模式在前端中的应用"><a href="#职责链模式在前端中的应用" class="headerlink" title="职责链模式在前端中的应用"></a>职责链模式在前端中的应用</h3><p>顾名思义，职责链模式就是建立一个流程链条，一个请求从一端进入，并从一个职责根据需求，流转进入另一个对象，直到找到合适的处理程序。</p>
<p>听上去似乎有点“中间件”的意思，我们来看一个简单的应用：账户付款时绑定一个基本帐户类，它连接了多种付款方式：paypal<br>支付、比特币支付，并根据不同付款方式的金额额度和付款额，选择第一个合适的账户进行支付逻辑：</p>
<pre><code>class Account &#123;
    next(account) &#123;
        this.successor = account
    &#125;

    pay(amount) &#123;
        if (this.canPay(amount)) &#123;
            console.log(`Paid $&#123;amount&#125; using $&#123;this.name&#125;`)
        &#125; else if (this.successor) &#123;
            console.log(`Cannot pay using $&#123;this.name&#125;. Proceeding...`)
            this.successor.pay(amount)
        &#125; else &#123;
            console.log(&#39;None of the accounts have enough balance&#39;)
        &#125;
    &#125;

    canPay(amount) &#123;
        return this.balance &gt;= amount
    &#125;
&#125;

class Bank extends Account &#123;
    constructor(balance) &#123;
        super()
        this.name = &#39;bank&#39;
        this.balance = balance
    &#125;
&#125;

class Paypal extends Account &#123;
    constructor(balance) &#123;
        super()        
        this.name = &#39;Paypal&#39;
        this.balance = balance
    &#125;
&#125;

class Bitcoin extends Account &#123;
    constructor(balance) &#123;
        super()        
        this.name = &#39;bitcoin&#39;
        this.balance = balance
    &#125;
&#125;</code></pre>
<p>在使用时，我们先给三个账户充钱：</p>
<pre><code>const bank = new Bank(100)          // Bank with balance 100
const paypal = new Paypal(200)      // Paypal with balance 200
const bitcoin = new Bitcoin(300)    // Bitcoin with balance 300</code></pre>
<p>并按顺序优先调用银行付款、PayPal 付款、比特币付款：</p>
<pre><code>bank.next(paypal)
paypal.next(bitcoin)</code></pre>
<p>最终付款行为：</p>
<pre><code>bank.pay(250)</code></pre>
<p>输出：</p>
<pre><code>Cannot pay using bank. Proceeding...
Cannot pay using Paypal. Proceeding...
Paid 250 using bitcoin</code></pre>
<h3 id="策略模式在前端中的应用"><a href="#策略模式在前端中的应用" class="headerlink" title="策略模式在前端中的应用"></a>策略模式在前端中的应用</h3><p>策略模式能够让开发者基于具体场景，来切换不同的算法或者策略。本身这个模式比较简单，但是有一个比较有意思的应用：V8<br>引擎在实现排序时，根据排序长度的不同，动态合理选用排序策略，达到尽可能的性能优化，例如代码：</p>
<pre><code>const bubbleSort = target =&gt; &#123;
    console.log(&#39;Sorting with bubble sort&#39;)
    // ...
    // ...
    return target
&#125;

const quickSort = target =&gt; &#123;
    console.log(&#39;Sorting with quick sort&#39;)
    // ...
    // ...
    return target
&#125;

const sorter = target =&gt; &#123;
    if(target.length &gt; 5)&#123;
        return quickSort(target)
    &#125; else &#123;
        return bubbleSort(target)
    &#125;
&#125;</code></pre>
<p>在目标数组长度大于 5 时使用快排，否则使用冒泡排序。感兴趣的读者可以自行了解 V8 的实现，看看这个分界策落的阈值（这里的例子中使用了<br>5）是多少，以及思考为什么选取该阈值。</p>
<p>上述代码的使用：</p>
<pre><code>const long = [1, 5, 4, 3, 2, 8]
const short = [1, 5, 4]

const result1 = sorter(long)
const result2 = sorter(short)</code></pre>
<p>输出：</p>
<pre><code>Sorting with quick sort
Sorting with bubble sort</code></pre>
<p>由此看出：第一个部分是策略类，策略类封装了具体的算法，并负责具体的计算过程；第二个部分是环境类，这个环境类接受客户的请求，随后把请求委托给某一个策略类。另一个应用策略模式的例子是表单校验：</p>
<pre><code>class Validator &#123;
  constructor() &#123;
    this.cache = []
  &#125;

  add(dom, rule, errorMsg) &#123;
    let array = rule.split(&#39;:&#39;)

    this.cache.push(function()&#123;
      var strategy = array.shift()
      array.unshift(dom.value)
      array.push(errorMsg)

      return strategies[strategy].apply(dom, array)
    &#125;)
  &#125;

  start() &#123;
    for (let i = 0, validatorFunc; validatorFunc = this.cache[i++]; i &lt; this.cache.length) &#123;
      const msg = validatorFunc()
      if (msg) return msg
    &#125;
  &#125;
&#125;

const strategies = &#123;
    isNonEmpty: function(value, errorMsg) &#123;
        if (value=&#39;&#39;) &#123;
            return errorMsg
        &#125;
    &#125;,
    minLength: function(value,length, errorMsg) &#123;
        if (value.length&lt;length) &#123;
            return errorMsg
        &#125;
    &#125;,
    isMobile: function(value, errorMsg) &#123;
        if (!/^1[3|5|8][0-9]$/.test(value)) &#123;
            return errorMsg
        &#125;
    &#125;
&#125;

const validataFunc = function()&#123;
    let validator = new Validator()
    validator.add(registerForm.userName, &#39;isNonEmpty&#39;, &#39;用户名不能为空’)
    validator.add(registerForm.password, &#39;inLength:6&#39; ,&#39;密码长度不能少于6位&#39;)
    validator.add(registerForm.phoneNumber, &#39;isMobile&#39;, &#39;手机号码格式不正确’)

    const  errorMsg = validator.start()
    return errorMsgs
&#125;

const registerForm = document.getElementById(&quot;registerForm&quot;)
registerForm.onsubmit = function() &#123;
    varerrorMsg = validataFunc()
    if (errorMsg) &#123;
        alert(errorMsg)
        return false 
    &#125;
&#125;</code></pre>
<p>其中，validataFunc 是我们的环境类，而 Validator 和 strategies 构成我们的策略。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这节课程讲解了：工厂模式、单例模式、建造者模式、外观模式、适配器模式、享元模式、代理模式、装饰者模式、职责链模式、策略模式等在前端中的实现和应用。同时，包括原型模式、观察者模式、迭代器模式在内，这些模式都非常贴近<br>JavaScript 原有语法，因此不再过多赘述。</p>
<p>实际上，设计模式很简单，我们应该做到的是需要应用时“胸中有数”，能够想到设计模式实现，而不需要一味死记硬背。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">小川</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jinxiaochuan.github.io/matrix/advanced/039--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8B%EF%BC%89/">https://jinxiaochuan.github.io/matrix/advanced/039--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8B%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jinxiaochuan.github.io/matrix" target="_blank">Matrix</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/matrix/engineering/01/"><img class="prev-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.feifanedu.com.cn%2FUserFiles%2F2018-8%2F201808311344020.jpg&amp;refer=http%3A%2F%2Fwww.feifanedu.com.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283768&amp;t=256a9b2ff52f7be67cb0123fba0a01ea" onerror="onerror=null;src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">01 | 项目基石：前端脚手架工具探秘</div></div></a></div><div class="next-post pull-right"><a href="/matrix/advanced/043--%E9%82%A3%E4%BA%9B%E5%B9%B4%E5%B8%B8%E8%80%83%E7%9A%84%E5%89%8D%E7%AB%AF%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%AD%EF%BC%89/"><img class="next-cover" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" onerror="onerror=null;src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">核心进阶43 | 那些年常考的前端算法（中）</div></div></a></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://cdn.byai.com/static/oss-script/24f46d0537131bf25d5519070dbfd06d.jpeg?x-oss-process=image/crop,x_0,y_120,w_1000,h_1000" onerror="this.onerror=null;this.src='https://ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy/zhidao/wh%3D680%2C800/sign=23605bff60600c33f02cd6ce227c7d37/b64543a98226cffc56142759b2014a90f603ea1b.jpg'" alt="avatar"/><div class="author-info__name">小川</div><div class="author-info__description">前端攻城狮</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/matrix/archives/"><div class="headline">文章</div><div class="length-num">53</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">工厂模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">外观模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">适配器模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">代理模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">装饰者模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">职责链模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">策略模式在前端中的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/matrix/algorithm/" title="FE Algorithm - 阶乘"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-1ef0181f71fe1bd731f172ff3b0fc2d3_1200x500.jpg&amp;refer=http%3A%2F%2Fpic4.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611282995&amp;t=42ae5101c61f264a349c808013a9c512" onerror="this.onerror=null;this.src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="FE Algorithm - 阶乘"/></a><div class="content"><a class="title" href="/matrix/algorithm/" title="FE Algorithm - 阶乘">FE Algorithm - 阶乘</a><time datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/matrix/advanced/038--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="核心进阶38 | 揭秘前端设计模式（上）"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" onerror="this.onerror=null;this.src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="核心进阶38 | 揭秘前端设计模式（上）"/></a><div class="content"><a class="title" href="/matrix/advanced/038--%E6%8F%AD%E7%A7%98%E5%89%8D%E7%AB%AF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="核心进阶38 | 揭秘前端设计模式（上）">核心进阶38 | 揭秘前端设计模式（上）</a><time datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/matrix/advanced/047--%E7%BC%93%E5%AD%98%E8%B0%81%E9%83%BD%E6%87%82%EF%BC%8C%E4%B8%80%E9%97%AE%E9%83%BD%E5%93%91%E5%B7%B4%EF%BC%88%E4%B8%8A%EF%BC%89/" title="核心进阶47 | 缓存谁都懂，一问都哑巴（上）"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" onerror="this.onerror=null;this.src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="核心进阶47 | 缓存谁都懂，一问都哑巴（上）"/></a><div class="content"><a class="title" href="/matrix/advanced/047--%E7%BC%93%E5%AD%98%E8%B0%81%E9%83%BD%E6%87%82%EF%BC%8C%E4%B8%80%E9%97%AE%E9%83%BD%E5%93%91%E5%B7%B4%EF%BC%88%E4%B8%8A%EF%BC%89/" title="核心进阶47 | 缓存谁都懂，一问都哑巴（上）">核心进阶47 | 缓存谁都懂，一问都哑巴（上）</a><time datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/matrix/advanced/049--HTTP%20%E7%9A%84%E6%B7%B1%E6%80%9D%EF%BC%9A%E6%88%91%E4%BB%8E%E4%BD%95%E8%80%8C%E6%9D%A5%EF%BC%8C%E5%8E%BB%E5%90%91%E4%BD%95%E5%A4%84/" title="核心进阶49 | HTTP 的深思：我从何而来，去向何处"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" onerror="this.onerror=null;this.src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="核心进阶49 | HTTP 的深思：我从何而来，去向何处"/></a><div class="content"><a class="title" href="/matrix/advanced/049--HTTP%20%E7%9A%84%E6%B7%B1%E6%80%9D%EF%BC%9A%E6%88%91%E4%BB%8E%E4%BD%95%E8%80%8C%E6%9D%A5%EF%BC%8C%E5%8E%BB%E5%90%91%E4%BD%95%E5%A4%84/" title="核心进阶49 | HTTP 的深思：我从何而来，去向何处">核心进阶49 | HTTP 的深思：我从何而来，去向何处</a><time datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/matrix/advanced/051--%E5%A4%A7%E8%AF%9D%E7%A4%BE%E5%8C%BA%E5%92%8C%E4%B8%80%E5%90%8D%E6%8A%80%E6%9C%AF%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="核心进阶51 | 大话社区和一名技术者的自我修养"><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F00.minipic.eastday.com%2F20170818%2F20170818115256_d41d8cd98f00b204e9800998ecf8427e_1.jpeg&amp;refer=http%3A%2F%2F00.minipic.eastday.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1611283231&amp;t=82f18a3b7b8ad76bf906bc78635e5360" onerror="this.onerror=null;this.src='https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1142711901,1643279206&amp;fm=26&amp;gp=0.jpg'" alt="核心进阶51 | 大话社区和一名技术者的自我修养"/></a><div class="content"><a class="title" href="/matrix/advanced/051--%E5%A4%A7%E8%AF%9D%E7%A4%BE%E5%8C%BA%E5%92%8C%E4%B8%80%E5%90%8D%E6%8A%80%E6%9C%AF%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="核心进阶51 | 大话社区和一名技术者的自我修养">核心进阶51 | 大话社区和一名技术者的自我修养</a><time datetime="2020-12-23T03:47:50.496Z" title="发表于 2020-12-23 11:47:50">2020-12-23</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By 小川</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/matrix/js/utils.js"></script><script src="/matrix/js/main.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>